import{r as o,o as W,j as e,i as _,J as K,K as M,N as Q,P as C,h as L,Q as z,A as G,y as X,R as Y,B as O,V as Z,U as ee}from"./index-BHyW0SRk.js";import{a as te}from"./normalCards-wWxWbdk-.js";import{l as se}from"./userAuthentication-DMHj8VLp.js";const ae=(h,y,a)=>{try{const d=new Set,j=new Set;y.forEach(m=>{const c=new Date(m.date.start).getTime(),l=new Date(m.date.end).getTime();if(h.startDate&&h.endDate){const u=new Date(h.startDate).getTime(),x=new Date(h.endDate).getTime(),g=u<c&&x>l||u>c&&u<l&&x>l||x<l&&x>c&&u<=c||u<=l&&x>=c;g?(console.log(`over lapping cars ${g} adding to OverlappingCars : `,m.carId.name),j.add(m.carId.toString())):(console.log(`cars not overlapping ${g} adding to eleigible cars : `,m.carId.name),d.add(m.carId.toString()))}});const p=[...a.filter(m=>m._id!==void 0&&!j.has(m._id.toString())&&!d.has(m._id.toString()))];return d.forEach(m=>{const c=a.find(l=>l._id!==void 0&&l._id.toString()===m);c&&p.push(c)}),console.log("unique cars :",p),p}catch(d){console.log(d)}},ne=()=>{const[h,y]=o.useState(null),[a,d]=o.useState(null),[j,w]=o.useState(null),[p,m]=o.useState(null),[c,l]=o.useState([]),[u,x]=o.useState([]),[g,E]=o.useState([]),[I,A]=o.useState(new Set),[R,k]=o.useState(""),[F,T]=o.useState(""),N=new Date().toISOString().split("T")[0];o.useState([]);const H=W(),D=new URLSearchParams(H.search).get("bookingData");o.useEffect(()=>{(async()=>{const s=await X("all","user");l(s);const n=new Set;if(s.forEach(i=>{var r;const f=i.seats?(r=i.seats)==null?void 0:r.toString():"",S=parseInt(f);isNaN(S)||n.add(S)}),A(n),D){const i=JSON.parse(D);d(i)}})()},[D]),o.useEffect(()=>{(async()=>{try{const s=await Y("all"),i=s.data.filter(f=>f.status!=="Cancelled");i.length===0?w(null):(console.log("valid bookings : ",i),w(s.data))}catch(s){O.error(s.messsage)}})()},[]),o.useEffect(()=>{(async()=>{try{const s=await Z(),n=c.map(r=>{var v;return(v=r.category)==null?void 0:v._id}).filter(r=>r!==null).map(r=>r),i=s.filter(r=>r._id&&n.includes(r._id)),f=[...g,...i],S=Array.from(new Set(f.map(r=>r==null?void 0:r._id))).map(r=>f.find(v=>(v==null?void 0:v._id)===r)).filter(r=>r!==void 0);E(S)}catch(s){O.error(s.message)}})()},[c]),o.useEffect(()=>{(async()=>{if(a&&j){const s=await ae(a,j,c);s&&(l(s),x(s))}else x(c)})()},[a,j]);const P=async(t,s)=>{const i=(await se(t)).data;y(i),s==="pickup"?(d(f=>({...f,pickupLocation:t})),k(t)):(d(f=>({...f,dropOffLocation:t})),T(t))},U=t=>{m(s=>s===t?null:t)},$=()=>{if(p===null)l(u);else{const t=u.filter(s=>{const n=s.rating;return n?n>=p:!1});l(t)}};o.useEffect(()=>{$()},[p]);const B=(t,s)=>{s==="pickup"?(d(n=>({...n,pickupLocation:t})),k(""),y([])):(d(n=>({...n,dropOffLocation:t})),T(""),y([]))},V=t=>{const s=u.filter(n=>{var i;return!!(n.category&&typeof n.category=="object"&&"_id"in n.category&&((i=n.category._id)==null?void 0:i.toString())===t)});l(s)},b=t=>{const s=u.filter(n=>n.seats===t);l(s)},q=()=>{const t=[...c].sort((s,n)=>(s.rentPricePerDay??0)-(n.rentPricePerDay??0));l(t)},J=()=>{const t=[...c].sort((s,n)=>(n.rentPricePerDay??0)-(s.rentPricePerDay??0));l(t)};return e.jsx("div",{className:"container-fluid full-container",children:e.jsx("div",{className:"contents",children:e.jsxs("div",{className:"row",style:{marginTop:"4rem"},children:[e.jsx("div",{className:"col-4",style:{padding:"12px"},children:e.jsx("div",{className:"left-contents",children:e.jsxs("div",{className:"row d-flex flex-column justify-content-center align-items-center",children:[e.jsxs("div",{className:"col-12",children:[e.jsx("p",{className:"font-text",children:"Sort by Price :"}),e.jsxs("div",{className:"d-flex justify-content-start align-items-start",children:[e.jsxs(_,{onClick:q,style:{height:"36px",width:"10rem"},children:[e.jsx(K,{className:"me-1"})," Low to High"]}),e.jsxs(_,{onClick:J,className:"ms-2",children:["High to Low ",e.jsx(M,{className:"ms-1"})]})]})]}),e.jsxs("div",{className:"col-12 mt-2",children:[e.jsx("p",{className:"font-text",children:"Sort by Rating :"}),e.jsx("div",{className:"d-flex flex-column justify-content-start align-items-start",children:[1,2,3,4,5].map((t,s)=>e.jsxs("div",{className:"d-flex align-items-center mb-2",children:[e.jsx("input",{type:"radio",className:"me-2",checked:p===t,onChange:()=>U(t)}),[...Array(t)].map((n,i)=>e.jsx(Q,{},i))]},s))})]}),e.jsxs("div",{className:"col-12 mt-2",children:[e.jsx("p",{className:"font-text",children:"sort by Category :"}),e.jsx("div",{className:"d-flex justify-content-start align-items-start",children:g&&g!==null&&g.map((t,s)=>e.jsx("div",{children:e.jsx(_,{onClick:()=>V(t._id?t._id:""),value:t._id,variant:"link",children:t.name})},s))})]}),e.jsxs("div",{className:"col-12 mt-2",children:[e.jsx("p",{className:"font-text",children:"Sort by Seats :"}),e.jsx("div",{className:"d-flex justify-content-start align-items-start",children:e.jsx("div",{children:e.jsxs(C,{children:[e.jsx(C.Toggle,{variant:"light",id:"dropdown-basic",children:"Select Seats"}),e.jsx(C.Menu,{children:[...I].map(t=>e.jsxs(C.Item,{onClick:()=>b(t),children:[t," Seater"]},t))})]})})})]})]})})}),e.jsx("div",{className:"col-8",children:e.jsx("div",{className:"row",children:e.jsxs("div",{className:"rightSide-content",children:[e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"right-top-contents d-flex justify-content-center align-items-center",children:[e.jsx("div",{className:"col-2 d-flex justify-content-center",children:e.jsx("input",{type:"date",value:a!=null&&a.startDate?new Date(a.startDate).toISOString().split("T")[0]:N,min:N,onChange:t=>{const s=new Date(t.target.value);d({...a,startDate:s})}})}),e.jsx("div",{className:"col-2 d-flex justify-content-center",children:e.jsx("input",{type:"date",value:a!=null&&a.endDate?new Date(a.endDate).toISOString().split("T")[0]:N,min:N,onChange:t=>{const s=new Date(t.target.value);d({...a,endDate:s})}})}),e.jsx("div",{className:"col-1 d-flex justify-content-center",children:e.jsx("input",{type:"time",value:a==null?void 0:a.pickupTime,onChange:t=>{const s=t.target.value,[n,i]=s.split(":"),f=`${n}:${i||"00"}`;d({...a,pickupTime:f})}})}),e.jsx("div",{className:"col-1 d-flex justify-content-center",children:e.jsx("input",{type:"time",value:a==null?void 0:a.dropOffTime,onChange:t=>{const s=t.target.value,[n,i]=s.split(":"),f=`${n}:${i||"00"}`;d({...a,dropOffTime:f})}})}),e.jsxs("div",{className:"col-3 d-flex justify-content-center position-relative",children:[e.jsx("input",{type:"text",style:{width:"120px"},placeholder:"select Starting",value:a==null?void 0:a.pickupLocation,onChange:t=>P(t.target.value,"pickup")}),R&&e.jsx("ul",{className:"suggestion-list",children:Array.isArray(h)&&h.map((t,s)=>e.jsxs("li",{className:"suggestion-item",onClick:()=>B(t.name,"pickup"),children:[e.jsxs("span",{className:"suggestion-text",children:[t.name,e.jsx("strong",{children:t.name}),e.jsx("br",{}),e.jsx("small",{children:t.place_formatted})]}),e.jsx(L,{className:"suggestion-icon"})]},s))})]}),e.jsxs("div",{className:"col-1 d-flex justify-content-center position-relative",children:[e.jsx("input",{type:"text",style:{width:"120px"},placeholder:"select ending",value:a==null?void 0:a.dropOffLocation,onChange:t=>P(t.target.value,"dropoff")}),F&&e.jsx("ul",{className:"suggestion-list",children:Array.isArray(h)&&h.map((t,s)=>e.jsxs("li",{className:"suggestion-item",onClick:()=>B(t.name,"dropoff"),children:[e.jsxs("span",{className:"suggestion-text",children:[t.name,e.jsx("strong",{children:t.name}),e.jsx("br",{}),e.jsx("small",{children:t.place_formatted})]}),e.jsx(L,{className:"suggestion-icon"})]},s))})]})]})}),e.jsxs("div",{className:"col-12 mt-4",children:[e.jsx("h5",{children:"Cars"}),e.jsx("div",{className:"right-bottom-contents",children:c.length>0?e.jsx(te,{cars:c,bookings:a}):e.jsxs("div",{className:"alert-container d-flex flex-column justify-content-center align-items-center mt-5",children:[e.jsx(z,{className:"exclamation-icon",style:{width:"30%",height:"auto"}}),e.jsx(G,{variant:"warning",className:"alert-message",children:"No cars found. But don't worry, we're still looking!"})]})})]})]})})})]})})})},oe=()=>e.jsxs(e.Fragment,{children:[e.jsx(ee,{}),e.jsx(ne,{})]});export{oe as default};
