import{r as n,ab as b,e as w,ak as D,n as U,j as s,aF as M,aG as P,aH as C,x as E,y as T,B as R,aI as A,aJ as F,U as H}from"./index-BE6Bgiq6.js";const O=()=>{const[d,g]=n.useState([]),[l,h]=n.useState(""),[z,j]=n.useState(null),[o,v]=n.useState(null),[a,y]=n.useState(null),f=n.useRef(null),x=n.useRef(null),{userId:i,partnerId:c,carId:p}=b(),[S,B]=n.useState(!1),k=w(e=>e.token.token)??"",r=D(k).payload,[J,N]=n.useState(null);n.useEffect(()=>{(async()=>{try{const[t,m,u]=await Promise.all([C(c),E(i),T(p,"user")]);v(t),j(m.data),y(u)}catch(t){R.error(t.message)}})()},[i,c,p]),n.useEffect(()=>{try{console.log("Attempting to connect to:","https://easyrentacar.shop/api/");const e=U("https://easyrentacar.shop");return console.log("Socket connection established:",e),x.current=e,e.on("connect",()=>{console.log("Socket connected successfully")}),e.on("disconnect",t=>{console.log("Socket disconnected:",t)}),e.on("error",t=>{console.error("Socket connection error:",t)}),e.emit("addUser",r),e.on("getUsers",t=>{console.log("getUsers event called with users:",t),N(t)}),e.on("getMessage",t=>{console.log("getMessage event called with data:",t);const m={...t,createdAt:new Date().toISOString()};g(u=>[...u,m])}),()=>{console.log("Cleaning up socket event listeners"),e.off("getUsers"),e.off("getMessage"),e.disconnect()}}catch(e){console.error("Socket initialization error:",e)}},[r]),n.useEffect(()=>{(async()=>{const t=await A(c,r,"partner");g(t)})()},[c,r]),n.useEffect(()=>{var e;(e=f.current)==null||e.scrollIntoView({behavior:"smooth"})},[d]);const I=async e=>{var t;e.preventDefault(),l&&((t=x.current)==null||t.emit("sendMessage",{senderId:r,receiverId:c,message:l}),await F(c,i,l),h(""))};return s.jsx("div",{className:"container-fluid content-container",children:s.jsxs("div",{className:"row",style:{marginTop:"5.5rem"},children:[s.jsx("div",{className:"col-12 col-md-3 left-col",children:s.jsxs("div",{className:"car-item mt-3",children:[s.jsx("div",{className:"image-container",children:s.jsx("img",{src:a==null?void 0:a.thumbnailImg,alt:a==null?void 0:a.name})}),s.jsx("strong",{className:"car-name mt-3",children:a==null?void 0:a.name}),s.jsxs("div",{className:"price-details mt-3",children:[s.jsx("h4",{children:"Price per Day"}),s.jsxs("h5",{children:["Price: ",a==null?void 0:a.rentPricePerDay]})]})]})}),s.jsx("div",{className:"col-12 col-md-9 right-col",children:s.jsxs("div",{className:"chat-box",children:[s.jsx("div",{className:"d-flex justify-content-center align-items-center bg-dark text-light py-3",children:s.jsx("h4",{className:"ms-5 mb-0",children:`Connected to: ${(o==null?void 0:o.name)||"Unknown"}`})}),s.jsx("div",{className:"message-list",children:d.map((e,t)=>s.jsx("div",{ref:t===d.length-1?f:null,children:s.jsx(M,{message:e,own:e.senderId===i,profileImage:(o==null?void 0:o.profilePic)||"",loading:S})},t))}),s.jsxs("form",{className:"message-input",onSubmit:I,children:[s.jsx("input",{type:"text",className:"form-control",value:l,onChange:e=>h(e.target.value),placeholder:"Type your message..."}),s.jsx("button",{type:"submit",className:"btn btn-primary",children:s.jsx(P,{})})]})]})})]})})},V=()=>s.jsxs(s.Fragment,{children:[s.jsx(H,{}),s.jsx(O,{})]});export{V as default};
