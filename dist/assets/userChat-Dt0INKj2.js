import{r as a,aa as k,e as D,aj as U,aE as b,j as s,aF as M,aG as P,aH as C,w as E,x as R,B as T,aI as A,aJ as F,U as H}from"./index-B1mh-_A2.js";const O=()=>{const[d,g]=a.useState([]),[l,h]=a.useState(""),[B,p]=a.useState(null),[r,v]=a.useState(null),[n,y]=a.useState(null),f=a.useRef(null),x=a.useRef(null),{userId:i,partnerId:c,carId:j}=k(),[N,G]=a.useState(!1),S=D(e=>e.token.token)??"",o=U(S).payload,[L,w]=a.useState(null);a.useEffect(()=>{(async()=>{try{const[t,m,u]=await Promise.all([C(c),E(i),R(j,"user")]);v(t),p(m.data),y(u)}catch(t){T.error(t.message)}})()},[i,c,j]),a.useEffect(()=>{try{const e=b("https://easyrentacar.shop/api/");return console.log(e),x.current=e,e.on("error",t=>{console.error("Socket connection error:",t)}),e.emit("addUser",o),e.on("getUsers",t=>{console.log("getUsers event called with users:",t),w(t)}),e.on("getMessage",t=>{console.log("getMessage event called with data:",t);const m={...t,createdAt:new Date().toISOString()};g(u=>[...u,m])}),()=>{console.log("Cleaning up socket event listeners"),e.off("getUsers"),e.off("getMessage"),e.disconnect()}}catch(e){console.error(e)}},[o]),a.useEffect(()=>{(async()=>{const t=await A(c,o,"partner");g(t)})()},[c,o]),a.useEffect(()=>{var e;(e=f.current)==null||e.scrollIntoView({behavior:"smooth"})},[d]);const I=async e=>{var t;e.preventDefault(),l&&((t=x.current)==null||t.emit("sendMessage",{senderId:o,receiverId:c,message:l}),await F(c,i,l),h(""))};return s.jsx("div",{className:"container-fluid content-container",children:s.jsxs("div",{className:"row",children:[s.jsx("div",{className:"col-12 col-md-5 left-col",children:s.jsxs("div",{className:"car-item mt-3 d-flex flex-column align-items-center",children:[s.jsx("div",{className:"image-container d-flex justify-content-center align-items-center",children:s.jsx("img",{src:n==null?void 0:n.thumbnailImg,style:{width:"50%",height:"auto"},alt:n==null?void 0:n.name})}),s.jsx("strong",{className:"car-name mt-3",children:n==null?void 0:n.name}),s.jsxs("div",{className:"price-details text-center mt-3",children:[s.jsx("h4",{children:"Price per Day"}),s.jsxs("h5",{children:["Price: ",n==null?void 0:n.rentPricePerDay]})]})]})}),s.jsx("div",{className:"col-7 right-col",children:s.jsxs("div",{className:"chat-box me-3",children:[s.jsx("div",{className:"d-flex justify-content-center align-items-center bg-dark text-light py-3 mb-1",style:{height:"12px"},children:s.jsx("h4",{className:"ms-5 mb-0",children:`Connected to: ${(r==null?void 0:r.name)||"Unknown"}`})}),s.jsx("div",{className:"message-list",children:d.map((e,t)=>s.jsx("div",{ref:t===d.length-1?f:null,children:s.jsx(M,{message:e,own:e.senderId===i,profileImage:(r==null?void 0:r.profilePic)||"",loading:N})},t))}),s.jsxs("form",{className:"message-input",onSubmit:I,children:[s.jsx("input",{type:"text",className:"form-control",value:l,onChange:e=>h(e.target.value)}),s.jsx("button",{type:"submit",className:"btn btn-primary",children:s.jsx(P,{})})]})]})})]})})},W=()=>s.jsxs(s.Fragment,{children:[s.jsx(H,{}),s.jsx(O,{})]});export{W as default};
