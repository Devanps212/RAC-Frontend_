import{r,o as K,j as e,i as T,J as M,K as Q,N as z,P as C,h as L,Q as G,A as W,y as X,R as Y,B as A,V as Z,U as ee}from"./index-Dts4eAQG.js";import{a as te}from"./normalCards-Clw-zBer.js";import{l as se}from"./userAuthentication-D6EInCqs.js";const ae=(u,g,a)=>{try{const l=new Set;return g.forEach(d=>{var f;const p=new Date(d.date.start).getTime(),j=new Date(d.date.end).getTime();if(u.startDate&&u.endDate){const m=new Date(u.startDate).getTime(),h=new Date(u.endDate).getTime();(m>=p&&m<=j||h>=p&&h<=j||m<=p&&h>=j)&&d&&d.carId&&d.carId._id&&l.add((f=d.carId)==null?void 0:f._id)}}),a.filter(d=>d._id!==void 0&&!l.has(d._id.toString()))}catch(l){console.log(l)}},ne=()=>{const[u,g]=r.useState(null),[a,l]=r.useState(null),[v,d]=r.useState(null),[p,j]=r.useState(null),[f,m]=r.useState([]),[h,w]=r.useState([]),[y,B]=r.useState([]),[E,I]=r.useState(new Set),[R,_]=r.useState(""),[F,k]=r.useState(""),N=new Date().toISOString().split("T")[0];r.useState([]);const H=K(),D=new URLSearchParams(H.search).get("bookingData");r.useEffect(()=>{(async()=>{const s=await X("all","user");m(s);const n=new Set;if(s.forEach(c=>{var i;const o=c.seats?(i=c.seats)==null?void 0:i.toString():"",S=parseInt(o);isNaN(S)||n.add(S)}),I(n),D){const c=JSON.parse(D);l(c)}})()},[D]),r.useEffect(()=>{(async()=>{try{const s=await Y("all");s.data.filter(o=>o.status!=="Cancelled").length===0?d(null):d(s.data)}catch(s){A.error(s.messsage)}})()},[]),r.useEffect(()=>{(async()=>{try{const s=await Z(),n=f.map(i=>{var x;return(x=i.category)==null?void 0:x._id}).filter(i=>i!==null).map(i=>i),c=s.filter(i=>i._id&&n.includes(i._id)),o=[...y,...c],S=Array.from(new Set(o.map(i=>i==null?void 0:i._id))).map(i=>o.find(x=>(x==null?void 0:x._id)===i)).filter(i=>i!==void 0);B(S)}catch(s){A.error(s.message)}})()},[f]),r.useEffect(()=>{(async()=>{if(a&&v){const s=await ae(a,v,f);s&&(m(s),w(s))}else w(f)})()},[a,v]);const O=async(t,s)=>{const c=(await se(t)).data;g(c),s==="pickup"?(l(o=>({...o,pickupLocation:t})),_(t)):(l(o=>({...o,dropOffLocation:t})),k(t))},U=t=>{j(s=>s===t?null:t)},V=()=>{if(p===null)m(h);else{const t=h.filter(s=>{const n=s.rating;return n?n>=p:!1});m(t)}};r.useEffect(()=>{V()},[p]);const P=(t,s)=>{s==="pickup"?(l(n=>({...n,pickupLocation:t})),_(""),g([])):(l(n=>({...n,dropOffLocation:t})),k(""),g([]))},$=t=>{const s=h.filter(n=>{var c;return!!(n.category&&typeof n.category=="object"&&"_id"in n.category&&((c=n.category._id)==null?void 0:c.toString())===t)});m(s)},q=t=>{const s=h.filter(n=>n.seats===t);m(s)},J=()=>{const t=[...f].sort((s,n)=>(s.rentPricePerDay??0)-(n.rentPricePerDay??0));m(t)},b=()=>{const t=[...f].sort((s,n)=>(n.rentPricePerDay??0)-(s.rentPricePerDay??0));m(t)};return e.jsx("div",{className:"container-fluid full-container",children:e.jsx("div",{className:"contents",children:e.jsxs("div",{className:"row",style:{marginTop:"4rem"},children:[e.jsx("div",{className:"col-lg-4 col-md-12",style:{padding:"12px"},children:e.jsx("div",{className:"left-contents",children:e.jsxs("div",{className:"row d-flex flex-column justify-content-center align-items-center",children:[e.jsxs("div",{className:"col-12",children:[e.jsx("p",{className:"font-text",children:"Sort by Price :"}),e.jsxs("div",{className:"d-flex justify-content-start align-items-start",children:[e.jsxs(T,{onClick:J,style:{height:"36px",width:"10rem"},children:[e.jsx(M,{className:"me-1"})," Low to High"]}),e.jsxs(T,{onClick:b,className:"ms-2",children:["High to Low ",e.jsx(Q,{className:"ms-1"})]})]})]}),e.jsxs("div",{className:"col-12 mt-2",children:[e.jsx("p",{className:"font-text",children:"Sort by Rating :"}),e.jsx("div",{className:"d-flex flex-column justify-content-start align-items-start",children:[1,2,3,4,5].map((t,s)=>e.jsxs("div",{className:"d-flex align-items-center mb-2",children:[e.jsx("input",{type:"radio",className:"me-2",checked:p===t,onChange:()=>U(t)}),[...Array(t)].map((n,c)=>e.jsx(z,{},c))]},s))})]}),e.jsxs("div",{className:"col-12 mt-2",children:[e.jsx("p",{className:"font-text",children:"sort by Category :"}),e.jsx("div",{className:"d-flex justify-content-start align-items-start",children:y&&y!==null&&y.map((t,s)=>e.jsx("div",{children:e.jsx(T,{onClick:()=>$(t._id?t._id:""),value:t._id,variant:"link",children:t.name})},s))})]}),e.jsxs("div",{className:"col-12 mt-2",children:[e.jsx("p",{className:"font-text",children:"Sort by Seats :"}),e.jsx("div",{className:"d-flex justify-content-start align-items-start",children:e.jsx("div",{children:e.jsxs(C,{children:[e.jsx(C.Toggle,{variant:"light",id:"dropdown-basic",children:"Select Seats"}),e.jsx(C.Menu,{children:[...E].map(t=>e.jsxs(C.Item,{onClick:()=>q(t),children:[t," Seater"]},t))})]})})})]})]})})}),e.jsx("div",{className:"col-lg-8 col-md-12",children:e.jsx("div",{className:"row",children:e.jsxs("div",{className:"rightSide-content",children:[e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"right-top-contents d-flex justify-content-center align-items-center",children:[e.jsx("div",{className:"col-4 col-md-2 d-flex justify-content-center pickup-date",children:e.jsx("input",{type:"date",value:a!=null&&a.startDate?new Date(a.startDate).toISOString().split("T")[0]:N,min:N,onChange:t=>{const s=new Date(t.target.value);l({...a,startDate:s})}})}),e.jsx("div",{className:"col-2 d-flex justify-content-center dropOffDate",children:e.jsx("input",{type:"date",value:a!=null&&a.endDate?new Date(a.endDate).toISOString().split("T")[0]:N,min:N,onChange:t=>{const s=new Date(t.target.value);l({...a,endDate:s})}})}),e.jsx("div",{className:"col-1 d-flex justify-content-center pickup-time",children:e.jsx("input",{type:"time",value:a==null?void 0:a.pickupTime,onChange:t=>{const s=t.target.value,[n,c]=s.split(":"),o=`${n}:${c||"00"}`;l({...a,pickupTime:o})}})}),e.jsx("div",{className:"col-1 d-flex justify-content-center dropOfTime",children:e.jsx("input",{type:"time",value:a==null?void 0:a.dropOffTime,onChange:t=>{const s=t.target.value,[n,c]=s.split(":"),o=`${n}:${c||"00"}`;l({...a,dropOffTime:o})}})}),e.jsxs("div",{className:"col-3 d-flex justify-content-center position-relative",children:[e.jsx("input",{type:"text",style:{width:"120px"},placeholder:"select Starting",value:a==null?void 0:a.pickupLocation,onChange:t=>O(t.target.value,"pickup")}),R&&e.jsx("ul",{className:"suggestion-list",children:Array.isArray(u)&&u.map((t,s)=>e.jsxs("li",{className:"suggestion-item",onClick:()=>P(t.name,"pickup"),children:[e.jsxs("span",{className:"suggestion-text",children:[t.name,e.jsx("strong",{children:t.name}),e.jsx("br",{}),e.jsx("small",{children:t.place_formatted})]}),e.jsx(L,{className:"suggestion-icon"})]},s))})]}),e.jsxs("div",{className:"col-1 d-flex justify-content-center position-relative dropOff-val",children:[e.jsx("input",{type:"text",style:{width:"120px"},placeholder:"select ending",value:a==null?void 0:a.dropOffLocation,onChange:t=>O(t.target.value,"dropoff")}),F&&e.jsx("ul",{className:"suggestion-list",children:Array.isArray(u)&&u.map((t,s)=>e.jsxs("li",{className:"suggestion-item",onClick:()=>P(t.name,"dropoff"),children:[e.jsxs("span",{className:"suggestion-text",children:[t.name,e.jsx("strong",{children:t.name}),e.jsx("br",{}),e.jsx("small",{children:t.place_formatted})]}),e.jsx(L,{className:"suggestion-icon"})]},s))})]})]})}),e.jsxs("div",{className:"col-12 mt-4",children:[e.jsx("h5",{children:"Cars"}),e.jsx("div",{className:"right-bottom-contents",children:f.length>0?e.jsx(te,{cars:f,bookings:a}):e.jsxs("div",{className:"alert-container d-flex flex-column justify-content-center align-items-center mt-5",children:[e.jsx(G,{className:"exclamation-icon",style:{width:"30%",height:"auto"}}),e.jsx(W,{variant:"warning",className:"alert-message",children:"No cars found. But don't worry, we're still looking!"})]})})]})]})})})]})})})},oe=()=>e.jsxs(e.Fragment,{children:[e.jsx(ee,{}),e.jsx(ne,{})]});export{oe as default};
