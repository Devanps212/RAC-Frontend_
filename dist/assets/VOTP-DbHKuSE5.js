import{B as a,a as O,r as m,u as T,e as P,l as x,j as e,s as S}from"./index-BXYH6E5X.js";import{a as D,u as k,o as h}from"./userAuthentication-1ie2nPGh.js";const w=async()=>{console.log("reached checkpurpose");const i=sessionStorage.getItem("user"),t=i?JSON.parse(i):null,u=sessionStorage.getItem("usersDetails"),r=u?JSON.parse(u):null;if(console.log("login Details : ",t),console.log("signUp Details : ",r),r&&r.purpose==="signup"){const{otp:c,purpose:n,...s}=r;console.log(" signup details ",s);try{const l=await D(s);if(console.log("response from signup",l),l.status==="success")return sessionStorage.removeItem("usersDetails"),{message:"signUp success",token:l.token}}catch(l){return console.log(l.message),{message:"error",error:l.message}}}else if(t&&t.purpose==="signin"){console.log("login detil checking : ",t);const{purpose:c,...n}=t;console.log(n);try{const s=await k(n);if(console.log("response from signin",s),s.status==="success")return console.log("login success"),sessionStorage.removeItem("user"),{message:"Login success",token:s.token}}catch(s){return console.log(s),{message:"error",error:s.message}}}return a.warning("no session found"),{message:"error",error:"no session found"}},I=async()=>{const i=sessionStorage.getItem("user"),t=i?JSON.parse(i):null,u=sessionStorage.getItem("usersDetails"),r=u?JSON.parse(u):null;if(console.log("login Details : ",t),console.log("signUp Details : ",r),r&&!t){console.log("reached for otp fetching");const c=await h(r.email);if(c){if(c.code===200)return console.log("OTP : ",c),c}else return console.log("no OTP found"),null}else if(t&&!r){console.log("reached for otp fetching");const{purpose:c,...n}=t,s=await h(n);return s.status==="success"?s:(console.log("no OTP found"),null)}},E=()=>{const i=O(),[t,u]=m.useState(""),[r,c]=m.useState(sessionStorage.getItem("otp")),[n,s]=m.useState(60),[l,U]=m.useState(""),j=sessionStorage.getItem("token"),p=T(),y=P(o=>o.userAuth.isLoggedIn);m.useEffect(()=>{const o=setInterval(()=>{s(d=>d>0?d-1:0)},1e3);return()=>{clearInterval(o),n===0&&c(null)}},[n]),m.useEffect(()=>{j&&p(x()),y==!0&&i("/")},[]);const v=async()=>{try{const o=await I();console.log("response from fetchingOtp : ",o),o.OTP&&(console.log("otp : ",o.OTP),c(o.OTP))}catch(o){console.error("Error generating OTP:",o.message),a.error(o.message)}},N=()=>{s(60),v()},b=async o=>{try{if(o.preventDefault(),console.log(n),n==0)return c(null),a.error("Otp is invalid");if(console.log("otp passing"),console.log("otp",t),console.log("totp",r),r!=null)if(console.log(),r.replace(/[^0-9]/g,"")===t){a.success("OTP is valid");const g=await w();if(console.log(g),g)if("token"in g){sessionStorage.removeItem("otp");const f=g.token;console.log("token: ",f),p(S(f)),p(x()),g.message==="Login success"?a.success("Login success"):g.message==="signUp success"&&a.success("SignUp success"),i("/")}else console.log(g.message),a.warning(g.error)}else a.error("Incorrect OTP")}catch(d){console.error("Error verifying OTP:",d.message),a.error(d.message)}};return e.jsx(e.Fragment,{children:e.jsx("div",{className:"container-fluid full-body-container",children:e.jsx("div",{className:"row justify-content-center align-items-center min-vh-100 bg-gray-200 py-5 pt-5",children:e.jsx("div",{className:"col-md-8",style:{backgroundColor:"#fff"},children:e.jsxs("div",{className:"row shadow",style:{marginRight:"-24px"},children:[e.jsxs("div",{className:"col-md-6 rounded-l-md bg-white p-4",style:{maxWidth:"450px"},children:[e.jsx("h1",{className:"text-xl font-semibold text-center",children:"Verify OTP"}),e.jsx("div",{className:"text-center",children:e.jsx("small",{className:"text-dark-400",children:"Enter the OTP code send to devanps@gmail.com"})}),e.jsxs("form",{className:"mt-4",onSubmit:b,children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"mb-2 block text-xs font-semibold",children:"OTP"}),e.jsx("input",{type:"number",placeholder:"Enter your OTP",value:t,className:"form-control rounded-md border border-gray-300 focus:border-purple-700 focus:outline-none focus:ring-1 focus:ring-purple-700 py-1 px-1.5 text-gray-500",style:{boxShadow:"inset 2px 2px 7px -3px grey"},onChange:o=>u(o.target.value)}),n>0?e.jsxs("p",{className:"text-center text-danger",children:["OTP Valid till: ",n," seconds"]}):e.jsx("p",{className:"text-center text-success",children:"OTP Timeout"})]}),n==0&&e.jsxs("div",{className:"text-center",children:[e.jsx("span",{className:"text-xs text-gray-400 font-semibold",children:"Didnt Get any OTP ?"}),e.jsx("a",{href:"#",className:"text-xs font-semibold text-purple-700",onClick:N,children:"Resend OTP"})]}),e.jsx("br",{}),l&&e.jsx("p",{className:"text-center text-danger",children:l}),e.jsx("div",{className:"text-center",children:e.jsx("button",{className:"buttonSub",type:"submit",children:"Verify"})}),e.jsx("br",{})]})]}),e.jsxs("div",{className:"banner col-md-6 rounded-r-md position-relative",children:[e.jsx("img",{className:"h-100 object-cover rounded-r-md",src:"/assets/admin/verifyOTP/242954.jpg",alt:"Login banner",style:{objectFit:"cover",width:"109%"}}),e.jsx("div",{className:"position-absolute top-0 start-50 translate-middle-x",children:e.jsx("p",{className:"quote text-center py-3",children:"Roam Free And Wild"})})]})]})})})})})},R=()=>e.jsx(E,{});export{R as default};
