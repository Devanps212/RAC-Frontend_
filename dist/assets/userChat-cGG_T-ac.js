import{r as a,aa as k,e as D,aj as U,aE as b,j as e,aF as M,aG as P,aH as C,w as E,x as R,B as T,aI as A,aJ as F,U as H}from"./index-5d5XzMmN.js";const O=()=>{const[d,g]=a.useState([]),[o,h]=a.useState(""),[B,p]=a.useState(null),[c,v]=a.useState(null),[n,N]=a.useState(null),f=a.useRef(null),x=a.useRef(null),{userId:i,partnerId:r,carId:j}=k(),[w,G]=a.useState(!1),y=D(s=>s.token.token)??"",l=U(y).payload,[L,I]=a.useState(null);a.useEffect(()=>{(async()=>{try{const[t,m,u]=await Promise.all([C(r),E(i),R(j,"user")]);v(t),p(m.data),N(u)}catch(t){T.error(t.message)}})()},[i,r,j]),a.useEffect(()=>{const s=b("http://localhost:5000/");return x.current=s,s.emit("addUser",l),s.on("getUsers",t=>{console.log("getUsers event called with users:",t),I(t)}),s.on("getMessage",t=>{console.log("getMessage event called with data:",t);const m={...t,createdAt:new Date().toISOString()};g(u=>[...u,m])}),()=>{console.log("Cleaning up socket event listeners"),s.off("getUsers"),s.off("getMessage"),s.disconnect()}},[l]),a.useEffect(()=>{(async()=>{const t=await A(r,l,"partner");g(t)})()},[r,l]),a.useEffect(()=>{var s;(s=f.current)==null||s.scrollIntoView({behavior:"smooth"})},[d]);const S=async s=>{var t;s.preventDefault(),o&&((t=x.current)==null||t.emit("sendMessage",{senderId:l,receiverId:r,message:o}),await F(r,i,o),h(""))};return e.jsx("div",{className:"container-fluid content-container",children:e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-12 col-md-5 left-col",children:e.jsxs("div",{className:"car-item mt-3 d-flex flex-column align-items-center",children:[e.jsx("div",{className:"image-container d-flex justify-content-center align-items-center",children:e.jsx("img",{src:n==null?void 0:n.thumbnailImg,style:{width:"50%",height:"auto"},alt:n==null?void 0:n.name})}),e.jsx("strong",{className:"car-name mt-3",children:n==null?void 0:n.name}),e.jsxs("div",{className:"price-details text-center mt-3",children:[e.jsx("h4",{children:"Price per Day"}),e.jsxs("h5",{children:["Price: ",n==null?void 0:n.rentPricePerDay]})]})]})}),e.jsx("div",{className:"col-7 right-col",children:e.jsxs("div",{className:"chat-box me-3",children:[e.jsx("div",{className:"d-flex justify-content-center align-items-center bg-dark text-light py-3 mb-1",style:{height:"12px"},children:e.jsx("h4",{className:"ms-5 mb-0",children:`Connected to: ${(c==null?void 0:c.name)||"Unknown"}`})}),e.jsx("div",{className:"message-list",children:d.map((s,t)=>e.jsx("div",{ref:t===d.length-1?f:null,children:e.jsx(M,{message:s,own:s.senderId===i,profileImage:(c==null?void 0:c.profilePic)||"",loading:w})},t))}),e.jsxs("form",{className:"message-input",onSubmit:S,children:[e.jsx("input",{type:"text",className:"form-control",value:o,onChange:s=>h(s.target.value)}),e.jsx("button",{type:"submit",className:"btn btn-primary",children:e.jsx(P,{})})]})]})})]})})},W=()=>e.jsxs(e.Fragment,{children:[e.jsx(H,{}),e.jsx(O,{})]});export{W as default};
