import{r as n,aa as I,e as b,aj as D,aE as U,j as s,aF as M,aG as P,aH as C,w as E,x as R,B as T,aI as A,aJ as F,U as H}from"./index-CPQZZLFC.js";const O=()=>{const[d,g]=n.useState([]),[l,h]=n.useState(""),[z,p]=n.useState(null),[c,v]=n.useState(null),[a,S]=n.useState(null),f=n.useRef(null),x=n.useRef(null),{userId:i,partnerId:o,carId:j}=I(),[y,B]=n.useState(!1),k=b(e=>e.token.token)??"",r=D(k).payload,[J,N]=n.useState(null);n.useEffect(()=>{(async()=>{try{const[t,m,u]=await Promise.all([C(o),E(i),R(j,"user")]);v(t),p(m.data),S(u)}catch(t){T.error(t.message)}})()},[i,o,j]),n.useEffect(()=>{try{console.log("Attempting to connect to:","https://easyrentacar.shop/api/");const e=U("https://easyrentacar.shop");return console.log("Socket connection established:",e),x.current=e,e.on("connect",()=>{console.log("Socket connected successfully")}),e.on("disconnect",t=>{console.log("Socket disconnected:",t)}),e.on("error",t=>{console.error("Socket connection error:",t)}),e.emit("addUser",r),e.on("getUsers",t=>{console.log("getUsers event called with users:",t),N(t)}),e.on("getMessage",t=>{console.log("getMessage event called with data:",t);const m={...t,createdAt:new Date().toISOString()};g(u=>[...u,m])}),()=>{console.log("Cleaning up socket event listeners"),e.off("getUsers"),e.off("getMessage"),e.disconnect()}}catch(e){console.error("Socket initialization error:",e)}},[r]),n.useEffect(()=>{(async()=>{const t=await A(o,r,"partner");g(t)})()},[o,r]),n.useEffect(()=>{var e;(e=f.current)==null||e.scrollIntoView({behavior:"smooth"})},[d]);const w=async e=>{var t;e.preventDefault(),l&&((t=x.current)==null||t.emit("sendMessage",{senderId:r,receiverId:o,message:l}),await F(o,i,l),h(""))};return s.jsx("div",{className:"container-fluid content-container",children:s.jsxs("div",{className:"row",children:[s.jsx("div",{className:"col-12 col-md-5 left-col",children:s.jsxs("div",{className:"car-item mt-3 d-flex flex-column align-items-center",children:[s.jsx("div",{className:"image-container d-flex justify-content-center align-items-center",children:s.jsx("img",{src:a==null?void 0:a.thumbnailImg,style:{width:"50%",height:"auto"},alt:a==null?void 0:a.name})}),s.jsx("strong",{className:"car-name mt-3",children:a==null?void 0:a.name}),s.jsxs("div",{className:"price-details text-center mt-3",children:[s.jsx("h4",{children:"Price per Day"}),s.jsxs("h5",{children:["Price: ",a==null?void 0:a.rentPricePerDay]})]})]})}),s.jsx("div",{className:"col-7 right-col",children:s.jsxs("div",{className:"chat-box me-3",children:[s.jsx("div",{className:"d-flex justify-content-center align-items-center bg-dark text-light py-3 mb-1",style:{height:"12px"},children:s.jsx("h4",{className:"ms-5 mb-0",children:`Connected to: ${(c==null?void 0:c.name)||"Unknown"}`})}),s.jsx("div",{className:"message-list",children:d.map((e,t)=>s.jsx("div",{ref:t===d.length-1?f:null,children:s.jsx(M,{message:e,own:e.senderId===i,profileImage:(c==null?void 0:c.profilePic)||"",loading:y})},t))}),s.jsxs("form",{className:"message-input",onSubmit:w,children:[s.jsx("input",{type:"text",className:"form-control",value:l,onChange:e=>h(e.target.value)}),s.jsx("button",{type:"submit",className:"btn btn-primary",children:s.jsx(P,{})})]})]})})]})})},V=()=>s.jsxs(s.Fragment,{children:[s.jsx(H,{}),s.jsx(O,{})]});export{V as default};
